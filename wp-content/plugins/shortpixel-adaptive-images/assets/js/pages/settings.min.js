(function(a){document.addEventListener("DOMContentLoaded",function(){var a=document.getElementById("chart");if(!(a instanceof HTMLElement))return!1;var b=a.parentNode,c=14;if(window.statusBox.chart.cdn.data.mb=window.statusBox.chart.cdn.data.mb.length<=c?window.statusBox.chart.cdn.data.mb:window.statusBox.chart.cdn.data.mb.slice(window.statusBox.chart.cdn.data.mb.length-c),window.statusBox.chart.cdn.labels=window.statusBox.chart.cdn.labels.length<=c?window.statusBox.chart.cdn.labels:window.statusBox.chart.cdn.labels.slice(window.statusBox.chart.cdn.labels.length-c),window.statusBox.chart.credits.labels=window.statusBox.chart.credits.labels.length<=c?window.statusBox.chart.credits.labels:window.statusBox.chart.credits.labels.slice(window.statusBox.chart.credits.labels.length-c),window.statusBox.chart.credits.data.paid=window.statusBox.chart.credits.data.paid.length<=c?window.statusBox.chart.credits.data.paid:window.statusBox.chart.credits.data.paid.slice(window.statusBox.chart.credits.data.paid.length-c),window.statusBox.chart.cdn.data.mb.length!==window.statusBox.chart.credits.data.paid.length){var d=window.statusBox.chart.cdn.data.mb.length>window.statusBox.chart.credits.data.paid.length?window.statusBox.chart.cdn.data.mb.length-window.statusBox.chart.credits.data.paid.length:window.statusBox.chart.credits.data.paid.length-window.statusBox.chart.cdn.data.mb.length,e=Array(d).fill(0);window.statusBox.chart.cdn.data.mb.length>window.statusBox.chart.credits.data.paid.length?window.statusBox.chart.credits.data.paid=e.concat(window.statusBox.chart.credits.data.paid):window.statusBox.chart.cdn.data.mb=e.concat(window.statusBox.chart.cdn.data.mb)}var f=window.statusBox.chart.cdn.labels.length>=window.statusBox.chart.credits.labels.length?window.statusBox.chart.cdn.labels:window.statusBox.chart.credits.labels,g=window.statusBox.chart.cdn.data.mb,h=window.statusBox.chart.credits.data.paid;b.classList.contains("expanded")||(f=f.slice(f.length/2),g=g.slice(g.length/2),h=h.slice(h.length/2)),window.statusBox.chart.instance=new Chart(document.getElementById("chart").getContext("2d"),{type:"line",data:{labels:f,datasets:[{label:window.statusBox.chart.titles.cdn,borderColor:window.statusBox.chart.colors.cdn,backgroundColor:window.statusBox.chart.backgrounds.cdn,fill:!0,pointHitRadius:10,data:g,yAxisID:"cdn"},{label:window.statusBox.chart.titles.credits,borderColor:window.statusBox.chart.colors.credits,backgroundColor:window.statusBox.chart.backgrounds.credits,fill:!0,pointHitRadius:10,data:h,yAxisID:"credits"}]},options:{responsive:!0,hoverMode:"index",stacked:!1,legend:{position:"top",labels:{boxWidth:20,usePointStyle:!0}},scales:{yAxes:[{type:"linear",display:!0,position:"left",id:"cdn"},{type:"linear",display:!0,position:"right",id:"credits",gridLines:{drawOnChartArea:!1}}]}}})}),a(function(){a(".box_dropdown.spai_news").addClass("opened"),b.loadNews(),window.spaiModeSwitchNotification&&b.showDecoratedNotice(window.spaiModeSwitchNotification)});var b={},c={};b.noticesQtyAtOneMoment=3,b.previousNotices=[],b.parseTab=function(a){return 0===a.indexOf("#top")&&(a=a.replace("#top","")),0===a.indexOf("#")&&a},b.prepareValue=function(a){var b=a.data("type"),c=a.prop("tagName").toLowerCase();return"string"===b?"input"===c||"textarea"===c?a.val():void 0:"int"===b?"input"===c?parseInt(a.val(),10):"textarea"===c?parseInt(a.text(),10):void 0:"bool"===b?a.prop("checked"):void 0},b.showDecoratedNotice=function(a){b.showNotice("<div class=\"notice notice-success is-dismissible\" data-icon=\"none\" data-causer=\"\"\t\t\t\t\t\t\t\tdata-plugin=\"short-pixel-ai\">\t\t\t\t<div class=\"body-wrap\">\t\t\t\t\t<div class=\"message-wrap\"><p>"+a+"</p></div>\t\t\t\t\t<div class=\"buttons-wrap\"></div>\t\t\t\t</div>\t\t\t</div>")},b.showNotice=function(b){if("string"==typeof b&&""!==b){var c=a("#wpbody .wrap h1"),d=a(".notice"),e=a(b).hide();if(0<d.length?d.last().after(e):c.after(e),this.previousNotices.push(e),this.previousNotices.length>this.noticesQtyAtOneMoment)for(var f,g=0;g<this.previousNotices.length-this.noticesQtyAtOneMoment;g++)f=this.previousNotices[g],f!==e&&(f.slideUp("fast",function(){f.remove()}),this.previousNotices.splice(g,1));a(document).trigger("wp-updates-notice-added"),e.slideDown("fast",function(){e.removeAttr("style"),a("html:not(:animated), body:not(:animated)").animate({scrollTop:c.offset().top},500)}),setTimeout(function(){e.slideUp("fast",function(){e.remove()})},2e4)}},b.getAjaxUrl=function(){return"string"==typeof ajaxurl&&""!==ajaxurl?ajaxurl:"/wp-admin/admin-ajax.php"},b.topAction=function(c,d){var e={default:c.html(),onPress:c.attr("data-pressed-text")};a.ajax({method:"post",url:b.getAjaxUrl(),data:{action:"shortpixel_ai_handle_page_action",page:"settings",data:{action:d}},beforeSend:function(){c.text(e.onPress),c.prop("disabled",!0)},success:function(a){"string"==typeof a.notice&&""!==a.notice&&b.showNotice(a.notice),c.prop("disabled",!1),a.reload&&(window.location.href="options-general.php?page=shortpixel-ai-settings")},complete:function(){c.html(e.default)}})},b.save=function(c){c.preventDefault();var d=a(this),e=d.find(".spai_settings_tab"),f=d.find("[type=\"submit\"]"),g={},h={url:d.attr("action"),method:d.attr("method")},i={text:{default:f.val(),saving:f.data("saving-text")}};h.url=h.url?h.url:b.getAjaxUrl(),h.method=h.method?h.method:"post",i.text.default=i.text.default?i.text.default:"Save Changes",i.text.saving=i.text.saving?i.text.saving:"Saving...",e.each(function(){var c=a(this),d=c.find("[name]"),e=c.attr("id");e&&(g[e]={}),d.each(function(){var c=a(this),d=c.attr("type"),f=c.attr("name"),h=c.prop("checked");"radio"===d?h&&(g[e][f]=b.prepareValue(c)):g[e][f]=b.prepareValue(c)})}),a.ajax({url:h.url,method:h.method,dataType:"json",data:{action:"shortpixel_ai_handle_page_action",page:"settings",data:{action:"save",options:JSON.stringify(g)}},beforeSend:function(){i.text.saving&&(f.prop("disabled",!0),f.val(i.text.saving))},success:function(c){"string"==typeof c.notice&&""!==c.notice&&(b.showNotice(c.notice),a("div.notice[data-causer=\"twicelossy\"]").length&&!a("input#lossy").is(":checked")&&a("div.notice[data-causer=\"twicelossy\"]").remove())},complete:function(){i.text.default&&(f.prop("disabled",!1),f.val(i.text.default))}})},b.updateChartData=function(){var a=window.statusBox.chart.instance,b=window.statusBox.chart.cdn.labels.length>=window.statusBox.chart.credits.labels.length?window.statusBox.chart.cdn.labels:window.statusBox.chart.credits.labels,c=window.statusBox.chart.cdn.data.mb,d=window.statusBox.chart.credits.data.paid;a.canvas.parentNode.classList.contains("expanded")||(b=b.slice(b.length/2),c=c.slice(c.length/2),d=d.slice(d.length/2)),a.data.labels=b,a.data.datasets=[{label:window.statusBox.chart.titles.cdn,borderColor:window.statusBox.chart.colors.cdn,backgroundColor:window.statusBox.chart.backgrounds.cdn,fill:!0,pointHitRadius:10,data:c,yAxisID:"cdn"},{label:window.statusBox.chart.titles.credits,borderColor:window.statusBox.chart.colors.credits,backgroundColor:window.statusBox.chart.backgrounds.credits,fill:!0,pointHitRadius:10,data:d,yAxisID:"credits"}]},b.loadNews=function(){if(!a(".box_dropdown.spai_news").hasClass("processed")){a("#spaiNewsFeed").addClass("loading");fetch("https://shortpixel.com/blog/feed/").then(a=>a.text()).then(a=>new window.DOMParser().parseFromString(a,"text/xml")).then(b=>{function c(a){const b=a.querySelector("description").textContent,c=document.createElement("div");c.innerHTML=b;let d=c.querySelector("img").outerHTML,e=c.innerText.replace("\u2192","").substring(0,500)+"\u2026";const f=`
<article class="item">
    <h3><a href="${a.querySelector("link").innerHTML}" target="_blank">${a.querySelector("title").innerHTML}</a></h3>
    <div class="image"><a href="${a.querySelector("link").innerHTML}" target="_blank">${d}</a></div>
    <div class="description">${e}</div>
    <div class="link"><a href="${a.querySelector("link").innerHTML}" target="_blank">${document.querySelector(".box_dropdown.spai_news").getAttribute("data-readmore")}</a></div>
</article>`;document.querySelector("#spaiNewsFeed").innerHTML+=f}a("#spaiNewsFeed").removeClass("loading"),a(".box_dropdown.spai_news").addClass("processed");const d=b.querySelectorAll("item");for(let a in d)if(c(d[a]),1<a)break})}},c.validateSelector=function(a){try{return document.querySelector(a),!0}catch(a){return!1}},c.prepare=function(){var b=a("[ data-setting=\"exclusion\"]");b.each(function(){var b=a(this),c=b.data("texts"),d=b.val();"object"!=typeof c&&(c={add:"Add",save:"Save"});var e=b.data("separator"),f=b.data("exclusion-type");e="string"==typeof e&&""!==e?e:",",f="string"==typeof f&&""!==f?f:"selectors";for(var g="string"==typeof d&&""!==d?d.split("string"==typeof e&&""!==e?e:","):[],h="",i=0,j=g[i];i<g.length;j=g[++i])h+="<div data-index=\""+i+"\" data-action=\"edit\"><span class=\"selector\">"+j+"</span><span data-action=\"delete\"></span></div>";var k=a("<div class=\"exclusion-wrap\" data-type=\""+f+"\"><div class=\"exclusions-content clearfix\" data-action=\"add\"><div class=\"plus\"></div>"+h+"</div><div class=\"buttons-wrap hidden\"><div class=\"error-message hidden\"></div>"+("urls"===f?"<select><option value=\"path\">Path</option><option value=\"regex\">RegEx</option><option value=\"http\">HTTP</option><option value=\"https\">HTTPS</option><option value=\"domain\">Domain</option></select> : ":"")+"<input type=\"text\"><button type=\"button\" class=\"dark_blue_link\" data-action=\"confirm\" data-texts="+JSON.stringify(c)+">"+c.add+"</button></div></div>");b.before(k),k.append(b)})},c.updateRealField=function(b,c){var d=[],e=b.data("separator");e="string"==typeof e&&""!==e?e:",",0<c.length&&c.each(function(){d.push(a(this).text())}),b.val(d.join(e))},c.updateWarningMessage=function(a,b){var c=parseInt(a.data("limit"),10);a.find("span").text(b),b>c?a.slideDown("fast"):a.slideUp("fast")},c.inputActionsHandler=function(b){var c=a(this),d=c.siblings("select"),e=d.find("option"),f=c.siblings("button");if("keypress"===b.type){["Enter"].includes(b.key)&&(b.preventDefault(),b.stopPropagation(),f.click())}else{if(0===d.length)return;var g=c.val(),h=[];0<e.length&&e.each(function(){h.push(a(this).val())}),h.forEach(function(a){0===g.indexOf(a+":")&&(c.val(g.replace(a+":","")),d.val(a))})}},c.actionsHandler=function(b){b.preventDefault(),b.stopPropagation();var d=a(this),e=d.parents("td"),f=e.find("p.warning"),g=d.parents(".exclusion-wrap"),h=g.find("textarea"),i=g.find(".buttons-wrap"),j=i.find(".error-message"),k=i.find("input"),l=i.find("select"),m=i.find("button"),n=g.find(".exclusions-content"),o=n.find(".selector"),p=n.find("div[data-index]"),q=k.val(),r=m.attr("data-texts"),s=d.attr("data-action"),t=d.attr("data-state"),u=h.data("exclusion-type");q="string"==typeof q&&""!==q?q.trim():"",s="string"==typeof s&&""!==s?s:void 0,t="confirm"===s&&"string"==typeof t&&""!==t?t:"add",u="string"==typeof u&&""!==u?u:"selectors";try{r=JSON.parse(r)}catch(a){r={add:"Add",save:"Save"}}switch(s){case"add":m.text(r.add).attr("data-state","add").removeAttr("data-editing"),k.removeClass("error").val(""),i.slideDown("fast"),j.text("").slideUp("fast"),k.focus();break;case"edit":var v=d.find(".selector");k.removeClass("error").val(v.text()),m.text(r.save).attr("data-state","save").attr("data-editing",d.attr("data-index")),i.slideDown("fast"),j.text("").slideUp("fast"),k.focus();break;case"delete":d.parents("div[data-index]").fadeOut("fast",function(){a(this).remove(),c.updateWarningMessage(f,e.find(".selector").length),c.updateRealField(h,n.find(".selector"))}),m.removeAttr("data-editing").removeAttr("data-state"),i.slideUp("fast"),k.removeClass("error").val(""),j.text("").slideUp("fast");break;case"confirm":var w=l.val(),x=!1,y="urls"===u?w+":"+q:q,z="urls"===u?[y]:y.split(",");if(z=z.map(function(a){return"string"==typeof a?a.trim():a}),"selectors"===u&&!c.validateSelector(q)){k.addClass("error"),j.html(window.exclusionsL10n.messages.selectors.invalid).slideDown("fast");break}for(var A,B=0,v=a(o[B]);B<o.length;v=a(o[++B]))if(A=v.text(),z=z.filter(function(a){return"save"===t&&v.parent().attr("data-index")===d.attr("data-editing")&&A===a||A!==a}),0>=z.length){x=!0,k.addClass("error"),j.html(window.exclusionsL10n.messages.selectors.alreadyExists).slideDown("fast");break}if(!!x)break;var C=function(b,c){var d=a("<div data-index=\""+(D+c)+"\" data-action=\"edit\" class=\"hidden\"><span class=\"selector\">"+b+"</span><span data-action=\"delete\"></span></div>");n.append(d),d.fadeIn("fast")};if("add"===t&&""!==q&&0<z.length){var D=0<p.length?parseInt(p.last().attr("data-index"),10)+1:0;z.map(C)}else if("save"===t&&""!==q&&0<z.length){var D=d.attr("data-editing");n.find("div[data-index=\""+D+"\"] .selector").text(z.shift()),0<z.length&&(D=0<p.length?parseInt(p.last().attr("data-index"),10)+1:0,z.map(C))}i.slideUp("fast"),k.removeClass("error").val(""),j.text("").slideUp("fast"),m.removeAttr("data-editing").removeAttr("data-state");}c.updateWarningMessage(f,e.find(".selector").length),c.updateRealField(h,n.find(".selector"))},a(function(){var d=a(this);if(""!==document.location.hash){var e=a("a[href=\""+document.location.hash+"\"]");a("#wpspai-tabs a.nav-tab").removeClass("nav-tab-active"),a(".spai_settings_tab").removeClass("active");var f=b.parseTab(e.attr("href"));if(!!f){var g=a(f);if(0<g.length&&(e.addClass("nav-tab-active"),g.addClass("active"),"function"==typeof window.Beacon&&"object"==typeof window.beaconConstants)){var h=g.attr("id");"undefined"!=typeof window.beaconConstants.suggestions[h]&&window.Beacon("suggest",window.beaconConstants.suggestions[h])}}}c.prepare(),d.on("click",".exclusion-wrap [data-action]",c.actionsHandler),d.on("change focus blur input keypress",".exclusion-wrap input",c.inputActionsHandler),d.on("submit","form#settings-form",b.save),d.on("click",".chart-wrap .toggle",function(){a(this).parent().toggleClass("expanded"),b.updateChartData()}),d.on("dblclick",".chart-wrap canvas",function(){window.matchMedia("(min-width : 850px)").matches&&(a(this).parent().toggleClass("expanded"),b.updateChartData())}),d.on("click","#wpspai-tabs a.nav-tab",function(){var c=a(this);a("#wpspai-tabs a.nav-tab").removeClass("nav-tab-active"),a(".spai_settings_tab").removeClass("active");var d=b.parseTab(c.attr("href"));if(!!d){var e=a(d);if(0<e.length){c.addClass("nav-tab-active"),e.addClass("active");var f=document.getElementsByClassName("shortpixel-offer-wso");if(f.length&&(f[0].style.display="#compression"===d?"none":"block"),"function"==typeof window.Beacon&&"object"==typeof window.beaconConstants){var g=e.attr("id");"undefined"!=typeof window.beaconConstants.suggestions[g]&&window.Beacon("suggest",window.beaconConstants.suggestions[g])}}}}),d.on("change","input[type=\"radio\"]",function(){var b=a(this),c=b.val();if("string"==typeof c&&""!==c){var d=b.parent(),e=d.siblings("p[data-explanation=\""+c+"\"]"),f=d.siblings("p[data-explanation]").not(e),g=d.siblings(".children-wrap[data-parent=\""+c+"\"]"),h=d.siblings(".children-wrap[data-parent]").not(g);f.addClass("hidden"),e.removeClass("hidden"),h.addClass("hidden"),g.removeClass("hidden")}});var i=function(){var b=a(this),c=b.parent("[data-depended]"),d=c.siblings("[data-depended]"),e=d.find("input[type=\"checkbox\"]:checked"),f=b.siblings(".notification_popup");if(b.hasClass("spai_triggers_notification")||b.prop("checked")&&0<f.length)f.removeClass("hidden"),b.prop("checked",!1),b.removeClass("spai_triggers_notification");else{var g=b.parent().find("input[data-depender]:checked").length;if(g)b.siblings(".children-wrap").removeClass("hidden"),b.siblings("[data-depended]").find("input[type=\"checkbox\"]").prop("checked",!0);else if(b.siblings(".children-wrap").addClass("hidden"),0<c.length&&0===e.length){var h=c.data("depended");h="string"==typeof h&&""!==h?h.split("|"):[];var i="";for(let a in h)i+="input[name=\""+h[a]+"\"],";var j=a(i.slice(0,-1));console.log(c,j),j.prop("checked",!1).siblings(".children-wrap").addClass("hidden")}}};d.on("change","input[type=\"checkbox\"]",i),d.on("keydown","input.spai_triggers_notification",i),d.on("paste","input.spai_triggers_notification",i),d.on("click",".notification_popup input[type=\"button\"]",function(){var b=a(this),c=b.parent(".notification_popup"),d=c.siblings(".children-wrap"),e=c.siblings("input[type=\"checkbox\"]");e.prop("checked",!0),d.removeClass("hidden"),c.addClass("hidden")}),d.on("click",".box_dropdown .title",function(){a(this).parent().toggleClass("opened")}),d.on("click",".spai_statusbox_wrap .title_wrap",function(){if(850>=document.body.clientWidth){var b=a(this),c=b.parent(),d=c.find(".box_content");c.toggleClass("expanded"),d.slideToggle("fast")}}),d.on("click","#clear_css_cache",function(){b.topAction(a(this),"clear css cache")}),d.on("click","#export_settings, .export-settings",function(){window.location.href="admin.php?page=shortpixel-ai-export-settings&noheader=true"}),d.on("change","#spai_settings_advanced",function(c){a("#spai_settings_advanced").prop("checked")||a("#spai_settings_advanced").data("popup-confirmed")?(b.topAction(a(".shortpixel-settings-tabs"),"enable advanced"),a(".shortpixel-settings-wrap").fadeOut("fast"),a(".wpf-settings").addClass("spai-loading")):(a("#spai_settings_advanced").prop("checked",!0),jQuery.spaiHelpOpenLocal(a(c.target).siblings(".spai_settings_advanced_popup")))}),d.on("click","#spaiHelp .spai_settings_advanced_popup .button-yes",function(){b.topAction(a(".shortpixel-settings-tabs"),"disable advanced"),a("#spai_settings_advanced").prop("checked",!1),a(".shortpixel-settings-wrap").fadeOut("fast"),a(".wpf-settings").addClass("spai-loading")}),d.on("click","#spaiHelp .spai_settings_advanced_popup .button-no",function(){jQuery.spaiHelpClose()});var j;(j=document.getElementById("import_settings_file"))&&j.addEventListener("change",function(){if(this.files&&this.files[0]){var a=new FileReader;a.onload=a=>{try{var b=JSON.parse(a.target.result);if("object"!=typeof b)throw"noobj";window.confirm("Load these settings? \n"+a.target.result)&&document.getElementById("import_settings_form").submit()}catch(a){alert("This file doesn't look like a SPAI Settings export.")}},a.readAsText(this.files[0])}}),d.on("submit","form#api-key-form",function(c){c.preventDefault();var d=a(this),e=d.find("[name]:not([type=\"hidden\"])"),f=d.find("[type=\"submit\"]"),g={url:d.attr("action"),method:d.attr("method")},h={text:{default:f.val(),saving:f.data("saving-text")}},i=!1;e.each(function(){var b=a(this),c=b.val();"string"==typeof c&&""!==c&&(i=!0)});i&&(g.url=g.url?g.url:b.getAjaxUrl(),g.method=g.method?g.method:"post",h.text.default=h.text.default?h.text.default:"Save",h.text.saving=h.text.saving?h.text.saving:"Saving...",a.ajax({method:g.method,url:g.url,data:d.serialize(),beforeSend:function(){f.text(h.text.saving),f.prop("disabled",!0)},success:function(a){a.success?a.reload&&document.location.reload():a.notice&&b.showNotice(a.notice)},complete:function(){f.text(h.text.default),f.prop("disabled",!1)}}))}),d.on("click",".spai_statusbox_wrap div:not(\".dismissed-notice\") [data-action], .spai_settings_tab div:not(\".dismissed-notice\") [data-action]",function(c){if(c.preventDefault(),!(0<a(c.target).closest(".dismissed-notice").length)){var d=a(this),e=d.attr("data-action"),f=d.prop("tagName").toLowerCase();e="string"==typeof e||""!==e?e:void 0,a.ajax({method:"post",url:b.getAjaxUrl(),data:{action:"shortpixel_ai_handle_page_action",page:"settings",data:{action:e}},beforeSend:function(){("button"===f||"input"===f)&&d.prop("disabled",!0)},success:function(a){a.success&&a.reload&&document.location.reload(),a.notice&&b.showNotice(a.notice)},complete:function(){("button"===f||"input"===f)&&d.prop("disabled",!1)}})}})})})(jQuery);